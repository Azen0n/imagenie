{% extends 'algorithm.html' %}
{% load static %}

{% block title %}{% include 'head.html' with title="–§–∏–ª—å—Ç—Ä –ì–∞—É—Å—Å–∞ ‚Äî Imagenie" %}{% endblock %}

{% block contents %}
    <a class="list-entry" href="#theory">–¢–µ–æ—Ä–∏—è</a>
    <a class="list-entry" href="#visualization">–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è</a>
    <a class="list-entry" href="#implementation">–†–µ–∞–ª–∏–∑–∞—Ü–∏—è</a>
    <a class="list-entry" href="#processing">–ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</a>
    <a class="list-entry" href="#further-reading">–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞</a>
{% endblock %}

{% block theory %}
    <div class="plate">
        <div class="inline-category title" id="theory">–†–∞–∑–º—ã—Ç–∏–µ –ø–æ –ì–∞—É—Å—Å—É</div>
    </div>
    <div class="plate">
        <div class="description">
            –†–∞–∑–º—ã—Ç–∏–µ –ø–æ –ì–∞—É—Å—Å—É –≤ —Ü–∏—Ñ—Ä–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π ‚Äî —Å–ø–æ—Å–æ–± —Ä–∞–∑–º—ã—Ç–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ –ì–∞—É—Å—Å–∞.
            <p>–≠—Ç–æ—Ç —ç—Ñ—Ñ–µ–∫—Ç —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞—Ö –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏—è —à—É–º–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ —Å–Ω–∏–∂–µ–Ω–∏—è
                –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏. –†–∞–∑–º—ã—Ç–∏–µ –ø–æ –ì–∞—É—Å—Å—É —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ —ç—Ç–∞–ø–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤
                –∞–ª–≥–æ—Ä–∏—Ç–º–∞—Ö –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–∞—Å—à—Ç–∞–±–∞—Ö.</p>
            <p>–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ä–∞–∑–º—ã—Ç–∏—è –ø–æ –ì–∞—É—Å—Å—É –∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ —Å–≤—ë—Ä—Ç–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –ø–æ–º–æ—â—å—é
                —Ñ—É–Ω–∫—Ü–∏–∏ –ì–∞—É—Å—Å–∞.</p>
            <p>–§—É–Ω–∫—Ü–∏—è –ì–∞—É—Å—Å–∞ –≤ –¥–≤—É—Ö –∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö</p>
            <p>$$f(x,y)=\frac{1}{\sqrt{2\pi}\sigma^{2}}e^{\frac{-(x^{2}+y^{2})}{2\sigma^{2}}}\tag{1}$$</p>
            <p>–≥–¥–µ \(x\), \(y\) ‚Äî –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ç–æ—á–∫–∏,</p>
            <p>–∞ \(ùúé\) ‚Äî —Å—Ä–µ–¥–Ω–µ–∫–≤–∞–¥—Ä–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è.</p>
            <p>–ß–µ–º –±–æ–ª—å—à–µ –ø–∞—Ä–∞–º–µ—Ç—Ä \(ùúé\), —Ç–µ–º —Å–∏–ª—å–Ω–µ–µ —Ä–∞–∑–º—ã–≤–∞–µ—Ç—Å—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ö–∞–∫ –ø—Ä–∞–≤–∏–ª–æ, —Ä–∞–¥–∏—É—Å —Ñ–∏–ª—å—Ç—Ä–∞ \(ùëü = 3ùúé\). –í
                —Ç–∞–∫–æ–º —Å–ª—É—á–∞–µ —Ä–∞–∑–º–µ—Ä –º–∞—Å–∫–∏ \(2ùëü+1√ó2ùëü+1\).</p>
            <p>–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –≤ –¥–≤—É—Ö –∏–∑–º–µ—Ä–µ–Ω–∏—è—Ö —ç—Ç–∞ —Ñ–æ—Ä–º—É–ª–∞ –¥–∞—ë—Ç –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç—å, –∫–æ–Ω—Ç—É—Ä—ã –∫–æ—Ç–æ—Ä–æ–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—Ç —Å–æ–±–æ–π
                –∫–æ–Ω—Ü–µ–Ω—Ç—Ä–∏—á–µ—Å–∫–∏–µ –æ–∫—Ä—É–∂–Ω–æ—Å—Ç–∏ —Å –Ω–æ—Ä–º–∞–ª—å–Ω—ã–º —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏, —Ç–æ –µ—Å—Ç—å –µ—Å–ª–∏
                –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –ø–∏–∫—Å–µ–ª–∏ –∫–∞–∫ —Å–≤–µ—Ä—Ç–∫—É –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–æ –ø–∏–∫—Å–µ–ª–∏, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω—ã–µ –±–ª–∏–∂–µ –∫ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–º—É
                –ø–∏–∫—Å–µ–ª—é, –±—É–¥—É—Ç –æ–∫–∞–∑—ã–≤–∞—Ç—å –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –±–æ–ª—å—à–µ, —á–µ–º –∫—Ä–∞–π–Ω–∏–µ.</p>
            <p>–î–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è \(I\) –∏—Ç–æ–≥–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ \(I'\) –±—É–¥–µ—Ç –ø–æ–ª—É—á–µ–Ω–æ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Å–ª–µ–¥—É—é—â–µ–π —Ñ–æ—Ä–º—É–ª—ã.</p>
            <p>$$I'(x,y)=\sum_{i=-r}^{+r}\sum_{j=-r}^{+r}I(x+i)(y+j)\cdot
                \frac{1}{\sqrt{2\pi}\sigma^{2}}e^{\frac{-(i^{2}+j^{2})}{2\sigma^{2}}}\tag{2}$$</p>
            <div class="text-end">
                <a class="description-source" href="#">–ò—Å—Ç–æ—á–Ω–∏–∫</a>
            </div>
        </div>
    </div>
{% endblock %}

{% block languages %}
    <div class="nav flex-column nav-pills" role="tablist" aria-orientation="vertical">
        <button class="nav-link active" data-bs-target="#python" type="button" role="tab"
                data-bs-toggle="pill">
            Python
        </button>
        <button class="nav-link mb-3" data-bs-target="#csharp" type="button" role="tab"
                data-bs-toggle="pill">
            C#
        </button>
    </div>
{% endblock %}

{% block implementation %}
    <div class="tab-pane fade show active" id="python" role="tabpanel">
        <div class="plate">
            <div class="mx-3">
                <pre><code class="language-python">import math

import numpy as np
from PIL import Image, ImageDraw


def get_gaussian_kernel(sigma: float) -> np.ndarray:
    r = int(sigma * 2)
    kernel = np.ndarray((2 * r + 1, 2 * r + 1))
    for y in range(2 * r + 1):
        for x in range(2 * r + 1):
            kernel[x][y] = 1 / (2 * math.pi * math.pow(sigma, 2)) * math.exp(
                -(math.pow(x - r, 2) + math.pow(y - r, 2)) / (2 * math.pow(sigma, 2)))
    return kernel


def gaussian_blur(image_path: str, sigma: float) -> Image:
    image = Image.open(image_path)
    image = image.convert('L')
    pix = image.load()
    new_image = Image.new(size=image.size, mode='L')
    draw = ImageDraw.Draw(new_image)
    kernel = get_gaussian_kernel(sigma)
    r = int(kernel.shape[0] / 2)
    for y in range(image.height):
        for x in range(image.width):
            amount = 0
            for y_kernel in range(kernel.shape[0]):
                for x_kernel in range(kernel.shape[0]):
                    if (0 <= (y - r + y_kernel) < image.height) and (0 <= (x - r + x_kernel) < image.width):
                        amount += pix[x + x_kernel - r, y + y_kernel - r] * kernel[x_kernel, y_kernel]
            draw.point((x, y), round(amount))
    return new_image</code></pre>
            </div>
        </div>
    </div>
    <div class="tab-pane fade" id="csharp" role="tabpanel">
        <div class="plate">
            <div class="mx-3">
                <pre><code class="language-csharp">private double[,] getGaussianKernel(double sigma)
        {
            int r = (int)(sigma * 2);

            double[,] kernel = new double[2*r+1, 2*r+1];
            for (int y = 0; y < 2*r+1; y++)
            {
                for (int x = 0; x < 2 * r + 1; x++)
                {
                    kernel[x, y] = 1 / (2 * Math.PI * Math.Pow(sigma, 2)) * Math.Exp(-(Math.Pow(x - r, 2) + Math.Pow(y - r, 2)) / (2 * Math.Pow(sigma, 2)));
                }
            }
            return kernel;
        }

private Bitmap gaussianBlur(Bitmap image, double sigma)
{
    Bitmap newImage = new Bitmap(image.Width, image.Height);
    double[,] kernel = getGaussianKernel(sigma);
    int r = kernel.GetLength(0) / 2;
    for (int y = 0; y < image.Height; y++)
    {
        for (int x = 0; x < image.Width; x++)
        {
            double amount = 0;
            for (int y_kernel = 0; y_kernel < kernel.GetLength(0); y_kernel++)
            {
                for (int x_kernel = 0; x_kernel < kernel.GetLength(1); x_kernel++)
                {
                    if (((y-r+y_kernel) >= 0 && (y-r+y_kernel) < image.Height) && ((x-r+x_kernel) >= 0 && (x-r+x_kernel) < image.Width))
                    {
                        var pixel = image.GetPixel(x + x_kernel - r, y + y_kernel - r);
                        double brightness = 0.299 * pixel.R + 0.587 * pixel.G + 0.114 * pixel.B;
                        amount += brightness * kernel[x_kernel, y_kernel];
                    }
                }
            }
            newImage.SetPixel(x, y, Color.FromArgb((int)amount, (int)amount, (int)amount));
        }
    }
    return newImage;
}</code></pre>
            </div>
        </div>
    </div>
{% endblock %}

{% block parameters %}
    <div class="mx-3 mt-2">
        <div class="mb-1">–ü–∞—Ä–∞–º–µ—Ç—Ä</div>
        <input class="form-control w-100" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–Ω–∞—á–µ–Ω–∏–µ" id="param1">
    </div>
{% endblock %}

{% block images %}
    <div class="m-2">
        <p class="description-label">–û—Ä–∏–≥–∏–Ω–∞–ª</p>
        <img class="image-element img-fluid" src="{% static '../static/img/original.png' %}"
             alt="Image (original)"
             id="img-original">
    </div>
    <div class="m-2">
        <p class="description-label">–ü–æ—Å–ª–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è</p>
        <img class="image-element img-fluid" src="https://i.imgur.com/HbXxePi.png"
             alt="Image (processed)"
             id="img-processed">
    </div>
{% endblock %}

{% block further_reading %}
    <div class="instruction-number">1</div>
    <div class="source-text">–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞
    </div>
    <img class="img-fluid" src="{% static '../static/img/flags/gb.svg' %}" alt="English">
{% endblock %}

{% block script %}
    <script src="{% static '../static/js/gaussian-visualization.js' %}"></script>
{% endblock %}